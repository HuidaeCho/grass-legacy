From mw@engees.u-strasbg.fr Wed Dec 15 09:33:39 1999
Return-Path: <mw@engees.u-strasbg.fr>
Received: from mgate.uni-hannover.de by hgeo02.geog.uni-hannover.de (SMI-8.6/SMI-SVR4)
	id JAA26985; Wed, 15 Dec 1999 09:33:38 GMT
Received: from amon.u-strasbg.fr by mgate.uni-hannover.de (PP) with ESMTP;
          Wed, 15 Dec 1999 09:34:00 +0100
Received: from engees.u-strasbg.fr (engees.u-strasbg.fr [130.79.246.48]) 
          by amon.u-strasbg.fr (8.9.1a/8.9.0) with ESMTP id JAA12624 
          for <neteler@geog.uni-hannover.de>;
          Wed, 15 Dec 1999 09:33:56 +0100 (MET)
Received: from INTERNET/SpoolDir by engees.u-strasbg.fr (Mercury 1.44);
          15 Dec 99 09:34:18 +0100
Received: from SpoolDir by INTERNET (Mercury 1.44); 15 Dec 99 09:34:16 +0100
Received: from engees.u-strasbg.fr (130.79.246.88) 
          by engees.u-strasbg.fr (Mercury 1.44) with ESMTP;
          15 Dec 99 09:34:08 +0100
Sender: mw@amon.u-strasbg.fr
Message-ID: <3857527A.B86D4314@engees.u-strasbg.fr>
Date: Wed, 15 Dec 1999 09:34:02 +0100
From: Michel Wurtz - ENGEES/CEREG <mw@engees.u-strasbg.fr>
Organization: ENGEES
X-Mailer: Mozilla 4.7 [en] (X11; I; Linux 2.0.30 i586)
X-Accept-Language: en
MIME-Version: 1.0
To: Markus Neteler <neteler@geog.uni-hannover.de>
Subject: Compiling grass5.0beta5 on slackware (bug correction)
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Status: RO
Content-Length: 5155
Lines: 165

Hello Markus,

I compiled grass5.0beta5 last night on Slackware Linux (with a 2.0.3x
kernel).  I found one bug, and something I don't know wether it's
a "feature" of libtiff.so.3.4.33 that is corrected in later version.
I'm currently compiling nviz. The process stopped abnormaly, but I
haven't yet looked what went wrong, so there may be a followup ;-)

BTW, I'm updating m.in.e00 for grass5.  It recognize now compressed
files directly (rewrote the whole input routines).  I'm still a little
bit confused at the db interface : gdbase, postgress, MySQL ?
do you know which one will the least confuse users that don't want
to compile or install another package (like for nviz, that require
the mast version of tk and MesaGL), and what will be the DB choice
for Grass ? I think you cannot have a good vector tool without a
DBMS (like Arc/Info)

I also don't forget v.digspline, and will look at it this week (I'm
free of teaching until january !)

Here are bug corrections :

In src/raster/r.surf.fractal

The compiler complains (and I agree with it) that rand1 and
gauss are used without arguments in spec_syn.c.  Both rand1
and gauss must be called with one argument (int). It is
only usefull the first time rand1 is called. So putting 0 is
OK (If you look the sources, you will notice that calling rand1
with a negative value will reinitialise the random generator).
Gauss simply pass its argument to rand1 (but call it two times
with the same arg, so calling gauss with a negative argument
reinitialises two times the random generator...).
The correction is straitforward :

Patch here ---------------------------------------------------->

*** spec_syn.c  Tue Dec 14 22:48:04 1999
--- spec_syn.c.orig     Tue Dec 14 22:47:58 1999
***************
*** 29,36 ****
        coeff,          /* No. of Fourier coeffficents to calc. */
        seed;                   /* Random number seed.                  */
  
!     float rand1( int),                /* Random number generators.          
*/
!       gauss( int);
  
  
  
--- 29,36 ----
        coeff,          /* No. of Fourier coeffficents to calc. */
        seed;                   /* Random number seed.                  */
  
!     float rand1(),            /* Random number generators.            */
!       gauss();
  
  
  
***************
*** 59,68 ****
      {
          /* Generate random Fourier coefficients. */
  
!         phase = TWOPI*rand1( 0);
  
          if ((row != 0) || (col != 0))
!       rad = pow(row*row + col*col,-(H+1)/2.0)*gauss( 0);
          else
        rad = 0.0;
  
--- 59,68 ----
      {
          /* Generate random Fourier coefficients. */
  
!         phase = TWOPI*rand1();
  
          if ((row != 0) || (col != 0))
!       rad = pow(row*row + col*col,-(H+1)/2.0)*gauss();
          else
        rad = 0.0;
  
***************
*** 94,101 ****
      for (row=1; row < nn/2; row++)
      for (col=1; col< nn/2; col++)
      {
!         phase = TWOPI*rand1( 0);
!         rad   = pow(row*row + col*col,-(H+1)/2.0)*gauss( 0);
  
          *(data[0] + row*nn + nn-col) = rad * cos(phase);
          *(data[1] + row*nn + nn-col) = rad * sin(phase);
--- 94,101 ----
      for (row=1; row < nn/2; row++)
      for (col=1; col< nn/2; col++)
      {
!         phase = TWOPI*rand1();
!         rad   = pow(row*row + col*col,-(H+1)/2.0)*gauss();
  
          *(data[0] + row*nn + nn-col) = rad * cos(phase);
          *(data[1] + row*nn + nn-col) = rad * sin(phase);

<--------------------------------------------------end of patch

In src/raster/r.tiff/cmd

The Gmakefile should include the jpeg lib for the tiff lib,
else you will have a lot of unreferenced functions at link time
(I think some tiff compression method use jpeg algorithms) :

Patch here ---------------------------------------------------->

*** Gmakefile   Tue Dec 14 23:01:41 1999
--- Gmakefile.orig      Tue Dec 14 23:01:39 1999
***************
*** 3,10 ****
  PGM1=r.in.tiff
  PGM2=r.out.tiff
  
! LIBTIFF = $(TIFFLIBPATH) -ltiff -ljpeg -lz $(MATHLIB)
! #LIBTIFF = $(TIFFLIBPATH) -ltiff -lz
  EXTRA_CFLAGS = $(TIFFINCPATH) $(XINCPATH) $(XMINCPATH)
  
  PGM1OFILES = \
--- 3,10 ----
  PGM1=r.in.tiff
  PGM2=r.out.tiff
  
! #LIBTIFF = $(TIFFLIBPATH) -ltiff -ljpeg -lz $(MATHLIB)
! LIBTIFF = $(TIFFLIBPATH) -ltiff -lz
  EXTRA_CFLAGS = $(TIFFINCPATH) $(XINCPATH) $(XMINCPATH)
  
  PGM1OFILES = \

<--------------------------------------------------end of patch

In src.contrib/SCS/raster/r.tangent/cmd

Big mess at compile time : u_short is not defined. Including
stdlib.h solved the problem. I presume it will not harm elsewhere...


Patch here ---------------------------------------------------->

*** r.in.tang.c Tue Dec 14 23:34:14 1999
--- r.in.tang.c.orig    Tue Dec 14 23:34:07 1999
***************
*** 1,6 ****
  #include <stdio.h>
  #include <stdlib.h>
- #include <unistd.h>
  #include "gis.h"
  
  #define COLORMAX 255
--- 1,5 ----

<--------------------------------------------------end of patch

That's all... 

Have a nice day
-- 
Michel Wurtz    ENGEES - CEREG
                1, quai Koch - BP 1039, F-67070 STRASBOURG cedex
                Tel: +33 03.88.24.82.45  Fax: +33 03.88.37.04.97

