<!doctype html public "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
   <meta name="GENERATOR" content="Mozilla/4.5 [en] (Win98; I) [Netscape]">
   <TITLE>s.surf.rst</TITLE>
</head>
<body>
<body bgcolor="#FFFFFF">
<img SRC="grass.smlogo.gif" >
<hr width=100% align=center size=6 no shade>


<h2>
NAME</h2>
<b><i>s.surf.rst</i> </b>- interpolation and topographic analysis from
given site data to GRASS floating point raster format using regularized
spline with tension
<br><i>(GRASS Site Program)</i>
<h2>
SYNOPSIS</h2>
<b>s.surf.rst</b>
<br><b>s.surf.rst help</b>
<br><b>s.surf.rst [-d]&nbsp;&nbsp; input </b>= name [<b>elev </b>= name]
[<b>elatt</b>=val] [<b>slope </b>= name] [<b>aspect
</b>= name] [<b>pcurv
</b>= name] [<b>tcurv </b>= name] [<b>mcurv </b>= name] [<b>maskmap</b>
= name] [<b>dmin </b>= val] [<b>zmult = </b>val] [<b>tension
</b>= val]
[<b>smooth </b>= val] [<b>smatt=</b>val] [<b>segmax = </b>val] [<b>npmin
</b>=
val] [<b>devi
</b>= name] [<b>treefile </b>= name] [<b>overfile </b>= name]
<br>&nbsp;
<h2>
DESCRIPTION</h2>
<i>s.surf.rst</i>
<br>This program interpolates the z<font size=-1>i</font>-values from point
data (e.g., elevations, climatic stations, drill holes, etc.) given in
a sites file named <i>input</i> as x|y|%z<font size=-2>1</font> %z<font size=-2>2</font>
...%z<font size=-2>i</font> ... to grid cells in the output raster file
<i>elev</i>
representing surface. The user can select which floating point attribute
will be interpolated by setting the parameter <i>elatt</i> to value i for
the i-th floating point attribute<b>.</b>
<p>As an option, simultaneously with interpolation, topographic parameters
slope, aspect, profile curvature (measured in the direction of steepest
slope), tangential curvature (measured in the direction of a tangent to
contour line) or mean curvature are computed and saved as raster files
specified by the options <i>slope, aspect, pcurv, tcurv, mcurv</i> respectively.
If <i>-d</i> flag is set the program outputs partial derivatives fx,fy,fxx,fyy,fxy
instead of slope, aspect, profile, tangential and mean curvatures respectively.
<p>User can define a raster file named <i>maskmap</i>, which will be used
as a mask. The interpolation is skipped for cells which have zero or NULL
value in mask. Data points are checked for identical points and the points
that are closer to each other than the given <i>dmin</i> are removed. Parameter
<i>zmult</i>
allows user to rescale the z-values for sites (useful e.g. for transformation
of elevations given in feet to meters, so that the proper values of slopes
and curvatures can be computed).
<p>Regularized spline with tension and smoothing is used for&nbsp; interpolation
and approximation. The <i>tension</i> parameter tunes the character of
the resulting surface from thin plate to membrane. For noisy data, it is
possible to define&nbsp; either a constant smoothing parameter <i>smooth</i>
which must be a positive number or a variable smoothing parameter by&nbsp;
setting the parameter <i>smatt</i> to value j for the j-th floating point
attribute representing the smoothing parameter for each point.&nbsp; The
resulting surface passes exactly through the data points which have smoothing
parameter zero. When smoothing is used, it is possible to output site file
<i>devi</i>
containing deviations of the resulting surface from the given data.
<p>If the number of given points is greater than <i>segmax</i>, segmented
processing is used. The region is split into rectangular segments, each
having less than
<i>segmax</i> points and interpolation is performed on
each segment of the region. To ensure smooth connection of segments the
interpolation function for each segment is computed using the points in
given segment and the points in its neighborhood which are in the rectangular
window surrounding the given segment. The number of points taken for interpolation
is controlled by <i>npmin</i>, the value of which must be larger than <i>segmax</i>.
User can choose to output vector files <i>treefile</i> and <i>overfile</i>
which represent quad tree used for segmentation and overlapping neighborhoods
from which additional points for interpolation on each segment were taken.
The program writes several important values to history file of raster map
<i>elev</i>.
If the input data have time stamp, the program creates time stamp for all
output files.
<p>The user must run <i>g.region</i> before the program to set the region
and resolution for interpolation.
<br>&nbsp;
<h2>
OPTIONS</h2>
The user can run this program either interactively or non-interactively.
The program will be run non-interactively if the user specifies program
arguments and flag settings on the command line using the form:
<p><b>s.surf.rst [-d] input </b>= name <b>elev </b>= name [<b>elatt</b>=val]
[<b> slope </b>= name] [<b> aspect </b>= name] [<b> pcurv </b>= name] [<b>
tcurv </b>= name] [<b> mcurv </b>= name] [<b> maskmap</b> = name] [<b>
dmin </b>= val] [<b> zmult = </b>val] [<b> tension </b>= val] [<b> smooth
</b>= val] [<b>smatt</b>=val] [<b> segmax = </b>val] [<b> npmin </b>= val]
[<b> devi </b>= name] [<b> treefile </b>= name] [<b> overfile </b>= name]
<p>Alternately, the user can simply type <b>s.surf.rst</b> on the command
line without program arguments. In this case, the user will be prompted
for parameter values and flag settings using the standard GRASS parser
interface described in the manual entry for<i> parser</i>.
<p><b>Flags</b>
<p><b>-d</b> Output partial derivatives instead of aspect, slope and curvatures.
<p><b>Parameters:</b>
<p><b>input </b>= <i>name</i>
<br>Use the existing site file name as input.
<p><b>elev </b>= <i>name</i>
<br>Output elevation values to raster file <i>name</i>.
<p><b>elatt</b>=<i>val</i>
<br>order of floating point site attribute to use for interpolation (1=first),
options (1-100), default is 1.
<p><b>slope </b>= <i>name</i>
<br>Output slope or dx values to raster file <i>name</i>.
<p><b>aspect </b>= <i>name</i>
<br>Output aspect or dy values to raster file <i>name</i>.
<p><b>pcurv </b>= <i>name</i>
<br>Output profile curvature or dxx values to raster file <i>name</i>.
<p><b>tcurv</b> = <i>name</i>
<br>Output tangential curvature or dyy values to raster file <i>name</i>.
<p><b>mcurv</b> = <i>name</i>
<br>Output mean curvature or dxy values to raster file <i>name</i>.
<p><b>maskmap</b> = <i>name</i>
<br>Use the existing raster file name as a mask.
<p><b>dmin</b> = <i>val</i>
<br>Set min distance between points to <i>val</i>. Default value is set
to 0.5 grid cell size.
<p><b>zmult</b> = <i>val</i>
<br>Convert z-values using conversion factor <i>val</i>. Default value
is 1.
<p><b>tension</b> =<i>val</i>
<br>Set tension to <i>val</i>. Default value is 40, appropriate for smooth
surfaces at scales 1-100m distances/cell size.
<p><b>smooth</b> = <i>val</i>
<br>Set smoothing parameter to <i>val</i>. Default value is 0.0.
<p><b>smatt</b>=<i>val</i>
<br>order of floating point attribute to use for variable smoothing parameter
<p><b>segmax</b> = <i>val</i>
<br>Set max number of points per segment to <i>val</i>. Default value is
40.
<p><b>npmin</b> = <i>val</i>
<br>Set min number of points for interpolation to <i>val</i>. Default value
is 200, for data with heterogeneous spatial distribution higher value is
suggested (see notes).
<p><b>devi</b> = <i>name</i>
<br>Output deviations to a site file <i>name</i>. (Used for smoothed surfaces)
<p><b>treefile</b> = <i>name</i>
<br>Output quad tree used for segmentation to vector file <i>name</i>
<p><b>overfile</b> = name
<br>Output overlapping neighborhoods used for segmentation to vector file
name.
<br>&nbsp;
<h2>
NOTES</h2>
<i>s.surf.rst</i><b> </b>uses regularized spline with tensionfor interpolation
from point data. Point data should be in a <a href="site_format.html">new
site format </a>, that means format x|y|%z<font size=-2>1</font> %z<font size=-2>2</font>
...%z<font size=-2>i</font> ..., instead of the old format which confused
categories with values (x|y|#z). If program detects the old format it will
allow users to have the site file rewritten to a new format automatically.
<p>The implementation has a segmentation procedure based on quadtrees which
enhances the efficiency for large data sets. The GRASS5.0 version has enhanced
segmentation which takes more points for the large segments, to reduce
the potential for visibility of segmentens in areas with sparse data.
<p>Special color tables are created by the program for output raster files.
In the GRASS5.0 version, the output color table for raster elevation file
with values only between 0-1 has reduced number of colors - this is a known
bug.
<p>Topographic parameters are computed directly from the interpolation
function so that the important relationships between these parameters are
preserved. The equations for computation of these parameters and their
interpretation is described in <a href="http://www2.gis.uiuc.edu:2280/modviz/papers/lmg.rev1.ps">(Mitasova and Hofierka
1993</a>). Slopes and aspect are computed in degrees (0-90 and 1-360 respectively).
The aspect raster file has value 0 assigned to flat areas (with slope less
than 0.1%) and to singular points with undefined aspect. Aspect points
downslope and is 90 to the North, 180 to the West, 270 to the South and
360 to the East, the values increase counterclockwise. Curvatures are positive
for convex and negative for concave areas. Singular points with undefined
curvatures have assigned zero values.
<p>The program gives warning when significant overshoots appear and higher
tension or smoothing should be used. Higher values of tension parameter
reduce the overshoots that can appear in surfaces with rapid change of
gradient. However, with tension too high the resulting surface changes
its behavior to membrane (rubber sheet stretched over the data points)
resulting in a peak or pit in each given point and everywhere else the
surface goes rapidly to trend. If digitized contours are used as input
data, high tension can cause artificial waves along contours and combination
of lower tension and smoothing is suggested for such case. Smoothing can
be also used to reduce the overshoots. Besides overshoots, very low tension
can cause visible segments and&nbsp; increase in npmin or tension is suggested
for such cases.For data with values changing over several magnitudes (sometimes
the concentration or density data) it is suggested to interpolate the log
of the values rather than the original ones.
<p>The program checks the numerical stability of the algorithm by computing
the values in given points. The root mean square deviation (rms) between
interpolated and given values is written into the history file of raster
map <b><i>elev</i></b>. For computation with smoothing set to 0. the rms
should be 0. Significant increase in tension is suggested if the rms is
unexpectedly high for this case. With smoothing parameter greater than
zero the surface will not pass exactly through the data points and the
higher the parameter the closer the surface will be to the trend. The rms
then represents a measure of smoothing effect on data. More detailed analysis
of smoothing effects can be performed using the output deviations option
and running s.univar on the site file with deviations.
<p>The program writes the values of parameters used in computation into
the comment part of history file <b><i>elev</i></b> as well as the following
values which help to evaluate the results and choose the suitable parameters:
minimum and maximum z values in the data file (zmin_data, zmax_data) and
in the interpolated raster map (zmin_int, zmax_int), rescaling parameter
used for normalization (dnorm), which influences the tension. It is important
to note that tension is a scale dependent parameter so for data at different
scales different tension parameters will be necessary. At the beginning
of the run the program outputs the value of dnorm and rescaled tension
fi. The value of fi should be around 10-50. If it is several magnitudes
lower or higher the given tension parameter should be changed accordingly.
<p>When the number of points in a site file is not too large (less than
800), the user can skip segmentation by setting <b><i>segmax</i></b> to
the number of data points.
<p>The program gives warning when user wants to interpolate outside the
rectangle given by minimum and maximum coordinates in site file, zoom into
the area where the points are is suggested in this case.
<p>When a mask is used, the program takes all points in the given region
for interpolation, including those in the area which is masked out, to
ensure proper interpolation along the border of the mask. It therefore
does not mask out the data points, if this is desirable, it must be done
outside s.surf.rst (e.g. using r.mask.points).
<p>For examples of applications see <a href="http://www.cecer.army.mil/grass/viz/VIZ.html">http://www.cecer.army.mil/grass/viz/VIZ.html</a>
<br>and<a href="http://www.cecer.army.mil/grass/viz/VIZ.html"> </a><a href="http://www2.gis.uiuc.edu:2280/modviz/">http://www2.gis.uiuc.edu:2280/modviz/</a>
<br>&nbsp;
<h2>
SEE ALSO</h2>
<a href="r.slope.aspect.html">r.slope.aspect,</a>
<a href="r.surf.idw.html">r.surf.idw</a>,
<a href="r.surf.idw2.html">r.surf.idw2</a>,
<a href="r.surf.contour.html">r.surf.contour</a>,
<a href="s.surf.idw.html">s.surf.idw</a>,
<a href="v.to.sites.html">v.to.sites</a>,
<a href="g.region.html">g.region</a>,
<a href="r.mask.html">r.mask</a>,
<a href="s.surf.tps.html">s.surf.tps</a>
<br>&nbsp;
<h2>
AUTHORS</h2>
<i>Original version of program (in FORTRAN) and GRASS enhancements:</i>
<br>Lubos Mitas, NCSA, University of Illinois at Urbana-Champaign, Illinois,
USA
<br>Helena Mitasova, Department of Geography, University of Illinois at
Urbana-Champaign, Champaign, Illinois, USA
<p><i>Modified program (translated to C, adapted for GRASS, new segmentation
procedure):</i>
<br>Irina Kosinovsky, US Army CERL, Champaign, Illinois, USA
<br>Dave Gerdes, US Army CERL, Champaign, Illinois, USA
<p><i>Modifications for new sites format and timestamping:</i>
<br>Darrel McCauley, Purdue University, West Laffayette, Indiana, USA
<br>&nbsp;
<br>&nbsp;
<h2>
REFERENCES</h2>
Mitas, L., Mitasova, H., 1999, Spatial Interpolation. In: P.Longley, M.F.
Goodchild, D.J. Maguire, D.W.Rhind (Eds.), <i>Geographical Information
Systems: Principles, Techniques, Management and Applications</i>, Wiley,
pp.481-492
<p>Mitasova H., Mitas L.,&nbsp; Brown W.M.,&nbsp; D.P. Gerdes, I. Kosinovsky,
Baker, T.1995, Modeling spatially and temporally distributed phenomena:
New methods and tools for GRASS GIS. <i>International Journal of GIS</i>,
9 (4), special issue on Integrating GIS and Environmental modeling, 433-446.
<p><a href="http://www2.gis.uiuc.edu:2280/modviz/papers/lmg.rev1.ps">Mitasova H. and Mitas L. 1993</a>: Interpolation
by Regularized Spline with Tension: I. Theory and Implementation, <i>Mathematical
Geology</i> 25, 641-655.
<p><a href="http://www2.gis.uiuc.edu:2280/modviz/papers/hmg.rev1.ps">Mitasova H. and Hofierka L. 1993</a>: Interpolation
by Regularized Spline with Tension: II. Application to Terrain Modeling
and Surface Geometry Analysis, <i>Mathematical Geology</i> 25, 657-667.
<p>Mitasova, H., 1992 : New capabilities for interpolation and topographic
analysis in GRASS, <i>GRASSclippings </i>6, No.2 (summer), p.13.
<p>Mitas, L., Mitasova H., 1988 : General variational approach to the interpolation
problem, <i>Computers and Mathematics with Applications </i>16, p. 983
<p>Talmi, A. and Gilat, G., 1977 : Method for Smooth Approximation of Data,
<i>Journal
of Computational Physics</i>, 23, p.93-123.
<p>Wahba, G., 1990, : Spline Models for Observational Data, CNMS-NSF Regional
Conference series in applied mathematics, 59, SIAM, Philadelphia, Pennsylvania.
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
</body>
</html>
