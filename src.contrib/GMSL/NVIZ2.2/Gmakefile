# $Id: Gmakefile,v 1.17 2001-02-07 04:14:22 cho Exp $
#
# Toplevel makefile for building everything

VER=2.2
NV_VER=nviz$(VER)
NVWISH_VER=NVWISH$(VER)
INSTALL_DIR=$(GISBASE)/etc/$(NV_VER)

SCRIPTDIR=$(NV_VER)/scripts

all: configure nvwish nviz install

#
# DO NOT CHANGE configure: TARGET TO doconfigure:
# SOME make WON'T WORK IF TARGET AND SHELL NAME ARE EQUAL.
#
configure:
	@DOCONFIGURE=YES ./doconfigure $(VER) "$(PQLIB)"

nvwish:
	$(GMAKE) $(LIBDIR)/libimage
	$(GMAKE) $(LIBDIR)/ogsf
	cd src ; $(GMAKE)

nviz:
	'rm' -rf $(INSTALL_DIR)
	mkdir $(INSTALL_DIR)

# Install the scripts in the appropriate directory
install:
	'rm' -rf $(INSTALL_DIR)/
	mkdir $(INSTALL_DIR)
	mkdir $(INSTALL_DIR)/scripts
	mkdir $(INSTALL_DIR)/bitmaps
	(cd scripts; cp script_get_line script_play script_tools script_file_tools $(INSTALL_DIR)/scripts)
	'cp' scripts/*.tcl $(INSTALL_DIR)/scripts
	'cp' scripts/*Index $(INSTALL_DIR)/scripts
	(cd bitmaps; tar -cf - *  | (cd $(INSTALL_DIR)/bitmaps; tar  -xf - 2>/dev/null ); true)
	cp scripts/$(NV_VER)_script $(INSTALL_DIR)/scripts
	cp scripts/$(NV_VER) $(GISBASE)/bin
	chmod ugo+x $(INSTALL_DIR)/scripts/$(NV_VER)_script \
		$(INSTALL_DIR)/scripts/script_file_tools \
		$(INSTALL_DIR)/scripts/script_get_line \
		$(INSTALL_DIR)/scripts/script_play \
		$(INSTALL_DIR)/scripts/script_tools \
		$(GISBASE)/bin/$(NV_VER)
	mv src/nvwish $(INSTALL_DIR)/$(NVWISH_VER)
