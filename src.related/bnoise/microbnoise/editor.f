CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C      PROGRAM EDITOR
C
C      AUTHOR:  DICK GAUTHIER, ANALYSIS & TECHNOLOGY, INC.
C
C      THIS IS A PREPROCESSOR TO LCDN TO CREATE IN A USER
C      FRIENDLY FASHON DATA CARDS FOR BNOISE.
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
       CHARACTER*1 STAR,ANS,BL,ST
       CHARACTER*10 NAME(2)
       CHARACTER*5 FMT(18)
       CHARACTER*13  FILE
       CHARACTER*3  ID(50),IDD,FID(300),ND(50)
       INTEGER*2 NWC(64),MIN(50),MAX(50),NOI(50),IG(50),IREC(300)
       INTEGER*2 XD(50),XN(50)
       DIMENSION PW(11),DD(15),XL(50),YL(50),HT(50)
       EQUIVALENCE (XD,XL),(XN,YL)
       DATA FMT(1),FMT(2),FMT(3),FMT(18)/'(1h ,','1A,2X',',F6.2',
     x')    '/
       DATA STAR/'*'/,BL/' '/
       CP1=SECOND(CP)
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C      WEAPON CODES
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
       OPEN(8,FILE='GUNTABLE.DAT'
     1,ACCESS='DIRECT',RECL=128)
       OPEN(7,FILE='TAPE7.DAT',STATUS='NEW')
       READ(8,REC=100) NWC
       NNWC=38
       JWC=0
       WRITE(0,10)
10     FORMAT(/' SELECT WEAPON CODES (0 TO END, 99 FOR ALL)')
20     WRITE(0,30)
30     FORMAT(/' WEAPON CODE: ')
       READ(5,*,ERR=60) IWC
       IF(IWC.EQ.0)  GO TO 80
       IF(IWC.NE.99)  GO TO 45
       DO 40  I=1,38
       READ(8,REC=NWC(I),ERR=40)PW,NAME,DD
       KWC=NWC(I)
       CALL  TRICK3(KWC,PW)
       WRITE(7,50)NAME
       CALL TRICKY(FMT,BL,DD)
40     CONTINUE
       GO TO 100
45     DO 47 I=1,38
       IF(IWC.EQ.NWC(I)) GO TO 49
47     CONTINUE
       GO TO 60
49     READ(8,REC=IWC,ERR=60)PW,NAME,DD
51     JWC=IWC
       CALL TRICK3(IWC,PW)
       WRITE(7,50) NAME
50     FORMAT(1H ,3X,2A10)
       CALL TRICKY(FMT,BL,DD)
       GO TO 20
60     WRITE(0,70)
70     FORMAT(' INVALID WEAPON CODE')
71     WRITE(0,72)
72     FORMAT(/' DO YOU WANT TO INPUT DATA FOR THIS CODE? ')
       READ(5,140)ANS
       IF(ANS.EQ.'N') GO TO 20
       IF(ANS.NE.'Y')  GO TO 71
       NNWC=NNWC+1
       NWC(NNWC)=IWC
       CALL NEWWC(PW,NAME,DD)
       GO TO 51
80     IF(JWC.NE.0) GO TO 100
       WRITE(0,90)
90     FORMAT(' NO WEAPON CODES SELECTED')
       GO TO 20
100    BACKSPACE 7
       CALL  TRICKY(FMT,STAR,DD)
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C       TARGET DATA
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
       CLOSE(8)
       WRITE(0,120)
120    FORMAT(/' ENTER TARGET DATA ')
       NUM=0
125    WRITE(0,130)
130    FORMAT(/' DO YOU WANT TO INPUT FROM A FILE? ')
       READ(5,140)ANS
140    FORMAT(A1)
       IF(ANS.EQ.'N') GO TO 200
       IF(ANS.NE.'Y') GO TO 125
       WRITE(0,150)
150    FORMAT(/' FILE NAME: ')
       READ(5,160)FILE
160    FORMAT(A13)
       OPEN(9,FILE=FILE,IOSTAT=I)
	   REWIND 9
       IF(I.EQ.0) GO TO 170
       WRITE(0,165)
165    FORMAT(' FILE ERROR')
       GO TO 125
170    READ(9,180,END=190)ND(NUM+1),XL(NUM+1),YL(NUM+1),HT(NUM+1)
180    FORMAT(2X,A3,1X,3F6.0)
188    FORMAT(1h ,2X,A3,1X,3F6.0)
       NUM=NUM+1
       GO TO 170
190    CLOSE(9)
200    WRITE(0,210)
210    FORMAT(/' ADD, DELETE, LIST, SAVE OR END: ')
       READ(5,140)ANS
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C       ADD
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
       IF(ANS.NE.'A') GO TO 290
       IF(NUM.LT.50)  GO TO 230
       WRITE(0,220)
220    FORMAT(' NO MORE TARGETS ALLOWED (50 MAX)')
       GO TO 200
230    NUM=NUM+1
235    WRITE(0,240)
240    FORMAT(/' TARGET ID: ')
       READ(5,250)ND(NUM)
       DO 245  I=1,NUM-1
       IF(ND(NUM).NE.ND(I)) GO TO 245
       WRITE(0,242)ND(NUM)
242    FORMAT(1X,A3,' ALREADY DEFINED')
       GO TO 235
245    CONTINUE
250    FORMAT(A3)
255    WRITE(0,260)
260    FORMAT(/' LOCATION, X-COORDINATE: ')
       READ(5,*,ERR=255)XL(NUM)
265    WRITE(0,270)
270    FORMAT(/' LOCATION, Y-COORDINATE: ')
       READ(5,*,ERR=265)YL(NUM)
275    WRITE(0,280)
280    FORMAT(/' GROUND CORRECTION FACTOR (dB)  [1.5]: ')
       READ(5,*,ERR=275)HT(NUM)
       GO TO 200
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C       DELETE
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
290    IF(ANS.NE.'D') GO TO 340
       IF(NUM.EQ.0) GO TO 200
       WRITE(0,240)
       READ(5,250)IDD
       DO 300 I=1,NUM
       J=I
       IF(IDD.NE.ND(I))GO TO 300
       GO TO 320
300    CONTINUE
       WRITE(0,310)IDD
310    FORMAT(1X,A3,' NOT FOUND')
       GO TO 200
320    NUM=NUM-1
       DO 330 I=J,NUM
       ND(I) = ND(I+1)
       XL(I) = XL(I+1)
       YL(I) = YL(I+1)
330    HT(I)  = HT(I+1)
       GO TO 200
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C       LIST
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
340    IF(ANS.NE.'L') GO TO 360
       DO 350 I=1,NUM
350    WRITE(0,188)ND(I),XL(I),YL(I),HT(I)
       GO TO 200
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C       SAVE
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
360    IF(ANS.NE.'S') GO TO 380
       WRITE(0,150)
       READ(5,160)FILE
       OPEN(9,FILE=FILE,STATUS='NEW')
	   REWIND 9
       DO  370 I=1,NUM
370    WRITE(9,188)ND(I),XL(I),YL(I),HT(I)
       CLOSE(9)
       GO TO 200
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C       END
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
380    IF(ANS.NE.'E') GO TO 200
       IF(NUM.NE.0) GO TO 385
       WRITE(0,382)
382    FORMAT(' NO TARGETS SELECTED')
       GO TO 200
385    DO 390  I=1,NUM-1
390    WRITE(7,188)ND(I),XL(I),YL(I),HT(I)
       WRITE(7,400)STAR,ND(NUM),XL(NUM),YL(NUM),HT(NUM)
       NUMT=NUM
400    FORMAT(1H ,A1,1X,A3,1X,3F6.0)
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C       FIRING POINT DATA
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
       WRITE(0,410)
410    FORMAT(/' ENTER FIRING POINT DATA')
       OPEN(13,STATUS='NEW',ACCESS='DIRECT',RECL=1280)
       NUM=0
       NEXT=0
420    WRITE(0,130)
       READ(5,140)ANS
       IF(ANS.EQ.'N') GO TO 480
       IF(ANS.NE.'Y') GO TO 420
       WRITE(0,150)
       READ(5,160)FILE
       OPEN(9,FILE=FILE,IOSTAT=I)
	   REWIND 9
       IF(I.EQ.0) GO  TO 430
       WRITE(0,165)
       GO TO 420
430    READ(9,440,END=470)FID(NUM+1),X,Y,GCF
       NUM=NUM+1
440    FORMAT(2X,A3,1X,3F6.0)
441    FORMAT(1h ,2X,A3,1X,3F6.0)
       I=0
450    I=I+1
       READ(9,460)ST,IG(I),XD(I),XN(I),MIN(I),MAX(I),ID(I),
     $ NOI(I),HT(I)
460    FORMAT(A1,17X,I2,2I4,2I2,A3,I1,F5.0)
469    FORMAT(1h ,A1,17X,I2,2I4,2I2,A3,I1,F5.0)
       DO  461  K=1,NNWC
       IF(IG(I).EQ.NWC(K)) GO TO 462
461    CONTINUE
       WRITE(0,*)' WEAPON CODE OF ',IG(I),' IS NOT DEFINED'
       I=I-1
       GO TO 450
462    IF(ID(I).EQ.'   ') GO TO 464
       DO 463 K=1,NUMT
       IF(ID(I).EQ.ND(K)) GO TO 464
463    CONTINUE
       WRITE(0,*)' TARGET ID OF ',ID(I),' IS NOT DEFINED'
       I=I-1
       GO TO 450
464    CONTINUE
       IF(ST.NE.STAR)  GO TO 450
       NEXT=NEXT+1
       IREC(NUM)=NEXT
       WRITE(13,REC=NEXT)FID(NUM),X,Y,GCF,I,IG,XD,XN,MIN,MAX,
     $ ID,NOI,HT
       GO TO 430
470    CLOSE(9)
480    WRITE(0,210)
       READ(5,140)ANS
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C       ADD
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
       IF(ANS.NE.'A') GO TO  720
       IF(NUM.LT.300)  GO TO 500
       WRITE(0,490)
490    FORMAT(' NO MORE FIRING POINTS ALLOWED (300 MAX)')
       GO TO 480
500    NUM=NUM+1
       WRITE(0,510)
510    FORMAT(/' FIRING POINT ID: ')
       READ(5,250)FID(NUM)
520    WRITE(0,260)
       READ(5,*,ERR=520)X
530    WRITE(0,270)
       READ(5,*,ERR=530)Y
540    WRITE(0,280)
       READ(5,*,ERR=540)GCF
       I=0
550    I=I+1
555    WRITE(0,560)
560    FORMAT(/' GUN TYPE (CODE): ')
       READ(5,*,ERR=555)IG(I)
       DO 565 K=1,NNWC
       IF(IG(I).EQ.NWC(K)) GO TO 570
565    CONTINUE
       WRITE(0,*)' WEAPON CODE OF ',IG(I),' IS NOT DEFINED'
       GO TO 555
570    WRITE(0,580)
580    FORMAT(/' NUMBER OF DAY FIRINGS [0]: ')
       READ(5,*,ERR=570)XD(I)
590    WRITE(0,600)
600    FORMAT(/' NUMBER OF NIGHT FIRINGS [0]: ')
       READ(5,*,ERR=590)XN(I)
610    WRITE(0,620)
620    FORMAT(/' MIN CHARGE ZONE: ')
       READ(5,*,ERR=610)MIN(I)
630    WRITE(0,640)
640    FORMAT(/' MAX CHARGE ZONE: ')
       READ(5,*,ERR=630)MAX(I)
645    WRITE(0,650)
650    FORMAT(/' CORRESPONDING TARGET ID: ')
       READ(5,250)ID(I)
       IF(ID(I).NE.'   ') GO TO 657
655    NOI(I)=1
       GO TO 680
657    DO 658 K=1,NUMT
       IF(ID(I).EQ.ND(K)) GO TO 660
658    CONTINUE
       WRITE(0,*)' TARGET ID OF ',ID(I),' IS NOT DEFINED'
       GO  TO 645
660    WRITE(0,670)
670    FORMAT(/' IS THERE NOISE AT THE TARGET?  ')
       READ(5,140)ANS
       IF(ANS.EQ.'N') GO TO  655
       IF(ANS.NE.'Y')  GO TO 660
       NOI(I)=0
680    WRITE(0,690)
690    FORMAT(/' HEIGHT (IN FEET): ')
       READ(5,*,ERR=680)HT(I)
       IF(I.EQ.50) GO TO 715
700    WRITE(0,710)
710    FORMAT(/' ARE THERE MORE GUN TYPES FOR THIS ID? ')
       READ(5,140)ANS
       IF(ANS.EQ.'Y') GO TO 550
       IF(ANS.NE.'N') GO TO700
715    NEXT=NEXT+1
       IREC(NUM)=NEXT
       WRITE(13,REC=NEXT)FID(NUM),X,Y,GCF,I,IG,XD,XN,MIN,MAX,
     $ ID,NOI,HT
       GO TO 480
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C       DELETE
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
720    IF(ANS.NE.'D') GO TO 760
       IF(NUM.EQ.0)  GO TO 480
       WRITE(0,510)
       READ(5,250)IDD
       DO 730 K=1,NUM
       J=K
       IF(IDD.NE.FID(K)) GO TO 730
       GO TO 740
730    CONTINUE
       WRITE(0,310)IDD
       GO TO 480
740    NUM=NUM-1
       DO 750 K=J,NUM
       FID(K)=FID(K+1)
750    IREC(K)=IREC(K+1)
       GO TO 480
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C       LIST
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
760    IF(ANS.NE.'L') GO TO 790
       IF(NUM.EQ.0) GO TO 480
       WRITE(0,510)
       READ(5,250)IDD
       DO 780 K=1,NUM
       IF(IDD.NE.FID(K)) GO TO  780
       READ(13,REC=IREC(K),ERR=775)IDD,X,Y,GCF,I,IG,XD,XN,MIN,MAX,
     $ ID,NOI,HT
       WRITE(0,441)IDD,X,Y,GCF
       DO 770 J=1,I
770    WRITE(0,469)BL,IG(J),XD(J),XN(J),MIN(J),MAX(J),ID(J),
     $ NOI(J),HT(J)
       GO  TO 480
775    WRITE(0,*)' ERROR',IREC(K)
       GO TO 480
780    CONTINUE
       WRITE(0,310)IDD
       GO TO  480
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C       SAVE
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
790    IF(ANS.NE.'S')  GO TO 820
       WRITE(0,150)
       READ(5,160)FILE
       OPEN(9,FILE=FILE,STATUS='NEW')
       DO 810 K=1,NUM
       READ(13,REC=IREC(K))IDD,X,Y,GCF,I,IG,XD,XN,MIN,MAX,
     $ ID,NOI,HT
       WRITE(9,441)IDD,X,Y,GCF
       DO 800 J=1,I-1
800    WRITE(9,469)BL,IG(J),XD(J),XN(J),MIN(J),MAX(J),ID(J),
     $ NOI(J),HT(J)
810    WRITE(9,469)STAR,IG(I),XD(I),XN(I),MIN(I),MAX(I),
     $ ID(I),NOI(I),HT(I)
       CLOSE(9)
       GO TO 480
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C       END
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
820    IF(ANS.NE.'E') GO TO 480
       IF(NUM.NE.0) GO TO 840
       WRITE(0,830)
830    FORMAT(' NO FIRING POINTS SELECTED')
       GO TO 480
840    DO 860 K=1,NUM
       READ(13,REC=IREC(K))IDD,X,Y,GCF,I,IG,XD,XN,MIN,MAX,
     $ ID,NOI,HT
       WRITE(7,441)IDD,X,Y,GCF
       DO 850 J=1,I-1
850    WRITE(7,469)BL,IG(J),XD(J),XN(J),MIN(J),MAX(J),ID(J),
     $ NOI(J),HT(J)
860    WRITE(7,469)STAR,IG(I),XD(I),XN(I),MIN(I),MAX(I),
     $ ID(I),NOI(I),HT(I)
       CLOSE(7)
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C       MODULE CARDS
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
       CALL MODULE
C      CP2=SECOND(CP)
C      CP=(CP2-CP1)/60.
C      WRITE(0,900)CP
C900    FORMAT(/' TIME IN EDITOR IS ',F6.1,' MINUTES')
       END
