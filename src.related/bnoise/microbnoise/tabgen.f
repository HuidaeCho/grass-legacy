	PROGRAM TABGEN
C     PROGRAM TABGEN(INPUT,OUTPUT,TAPE5=INPUT,TAPE6=OUTPUT,TAPE20)
      CHARACTER*10 NAME1,NAME2
      REAL IN(2,40),OUT(1000)
	  CHARACTER*5 MILE,FEET,INC(40)
      DATA MILE/'MILE '/,  FEET/'FEET '/
1     FORMAT(3F10.0)
2     FORMAT(2F10.0,A5) 
3     FORMAT(I2)
4     FORMAT(2I10,2F10.0,2A10)
    5 FORMAT(1H1,27HTABLE GENERATION PROGRAM --,3F6.2,18H PERCENT INVERS
     1ION)
6     FORMAT(2F10.2,A5,  20X , 2F10.2 ) 
7     FORMAT (1H ,8X,2I10,  2F10.2,  4X,  2A10) 
8     FORMAT(1H ,  ////(1H ,8X,10F6.1)) 
9     FORMAT( 1H1,8X,  2A10,  30X,  I5)
      KIN=7 
      KOUT=6
	OPEN(KIN,FILE='TABGENIN.DAT')
C	OPEN(KOUT,FILE='LPT1',STATUS='NEW')
	OPEN(20,FILE='TAPE20.DAT',
     1STATUS='NEW',FORM='UNFORMATTED')
      REWIND 20 
	  REWIND 7
      READ(KIN,1) PC1,PC2, PC3
      WRITE(KOUT,5) PC1,PC2,PC3 
      WRITE(20) PC1,PC2      ,PC3 
      READ(KIN,3)LOOP 
      DO 1000 I=1,LOOP
      READ(KIN,4) NUM,L1,RMULT,ROFFS,NAME1,NAME2
C     IF (EOF(KIN)) GOTO 999
       WRITE(KOUT,9) NAME1,NAME2    , I 
      WRITE(KOUT,7)NUM,L1,RMULT,ROFFS,NAME1,NAME2 
      DO 500 J=1,NUM
      READ (KIN,2) (IN(K,J),K=1,2),INC(J)
C     IF (EOF(KIN)) GOTO 999
C      CONVERT TO METERS
      DIST = IN(2,J)
      IF (INC(J).EQ.FEET) IN(2,J)=IN(2,J)  * .3048 
       IF (INC(J) .EQ. MILE)  IN(2,J) = IN(2,J) * 1609.344 
       POS = RMULT * ALOG10(IN(2,J)) + ROFFS
       WRITE (KOUT,6)  IN(1,J),DIST, INC(J) , IN(2,J) , POS
      IN(2,J)=POS 
500   CONTINUE
      M= IN(2,1) +0.5 
C     SET LOWER POINT EQ TO FIRST POINT 
      DO 400 L=1,M
400   OUT(L)=IN(1,1)
      M=M+1 
      M1 = IN(2,NUM) + 0.5 -1.0 
       IF  (M1 .GT.  L1)  M1= L1
      N=1 
      DO 450 L=M,M1 
455   IF (L+0.5 .LT. IN(2,N+1) )  GOTO 460
      N=N+1 
      GOTO 455
C     INTERPOLATION 
460   OUT(L) = (L+0.5 - IN(2,N)) * (IN(1,N+1) - 
     1 IN(1,N) ) / (IN(2,N+1) - IN(2,N)) + IN(1,N)
450   CONTINUE
      M1=M1+1 
        IF  (M1 .GT.  L1)  GOTO  476
      DO 475 L=M1,L1
475   OUT(L)= IN(1,NUM) 
476   WRITE(20) (OUT(L),L=1,L1) 
      WRITE(KOUT,8)             (OUT(L),L=1,L1) 
1000  CONTINUE
      GO TO 900
999    WRITE(KOUT,10) 
10     FORMAT(1H0,14HERROR IN INPUT)
900	CONTINUE
      END 
