#include "gis.h"

CELL *
get_training_categories (name, mapset, ncats)
    char *name, *mapset;
    int *ncats;
{
    FILE *fd, *fopen();
    char command[1024];
    int n;
    CELL *list;
    long cat;

    list = NULL;
    n = 0;
    sprintf (command, "r.stats -z '%s'", G_fully_qualified_name (name, mapset));
    fd = popen (command, "r");

    while (fscanf (fd, "%ld", &cat) == 1)
	if (cat != 0)
	{
		n++;
		list = (int *) G_realloc (list, n * sizeof(CELL));
		list[n-1] = (CELL) cat;
	}
    pclose (fd);

    if (n==0)
    {
	fprintf (stderr, "ERROR: raster map %s has no non-zero categories\n", name);
	exit(1);
    }

    *ncats = n;
    return list;
}

