<!doctype html public "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
   <meta name="GENERATOR" content="Mozilla/4.5 [en] (Win98; I) [Netscape]">
   <TITLE>s.surf.tps</TITLE>
</head>
<body bgcolor="#FFFFFF">
<img SRC="grass.smlogo.gif" >
<hr width=100% align=center size=6 no shade>
<h2>
NAME</h2>
<b><i>s.surf.tps</i></b> - Interpolates and computes topographic analysis
from given site data to GRASS raster format using spline with tension (integer
version from GRASS4.1, use <b><i>s.surf.rst</i></b> for floating point
in GRASS5.0).
<br><i>(GRASS Raster Program)</i>
<h2>
SYNOPSIS</h2>
<b>s.surf.tps</b>
<br><b>s.surf.tps help</b>
<br><b>s.surf.tps input = name</b> <b>elev = name</b> [<b>slope = name</b>]
[<b>aspect = name</b>] [<b>pcurv = name</b>] [<b>tcurv = name</b>] [<b>mcurv
= name</b>] [<b>maskmap= name</b>] [<b>dmin1 = val</b>] [<b>zmult = val</b>]
[<b>tension = val</b>] [<b>smooth = val</b>] [<b>segmax = val</b>] [<b>npmin
= val</b>]
<h2>
DESCRIPTION</h2>
<i>s.surf.tps</i>
<br>This program interpolates the values to grid cells from point data
(digitized contours, climatic stations, drill holes, etc.) given in a sites
file named <i>input</i>. The output raster file is <i>elev</i>. As an option,
simultaneously with interpolation, topographic parameters slope, aspect,
profile curvature (measured in the direction of steepest slope), tangential
curvature (measured in the direction of a tangent to contour line) or mean
curvature are computed and saved as raster files as specified by the options
<i>slope,
aspect, pcurv, tcurv, mcurv</i> respectively.
<p>User can define a raster file named <i>maskmap</i>, which will be used
as a mask. The interpolation is skipped for cells which have zero value
in mask. Zero values will be assigned to these cells in all output raster
files.
<p>Data points are checked for identical points and points that are closer
to each other, then the given <i>dmin1</i> are removed (this is necessary
especially for digitized contours). Parameter <i>zmult</i> allows the user
to rescale the z-values for sites (useful, e.g., for transformation of
elevations given in feet to meters, so that the proper values of slopes
and curvatures can be computed).
<p>Regularized spline with tension is used for the interpolation. The <i>tension</i>
parameter tunes the character of the resulting surface from thin plate
to membrane. Higher values of tension parameter reduce the overshoots that
can appear in surfaces with rapid change of gradient (see suggested values
for different types of surfaces given in notes). For noisy data, it is
possible to define a smoothing parameter, <i>smooth</i>. With the smoothing
parameter set to zero (<i>smooth=0</i>), the resulting surface passes exactly
through the data points.
<p>If the number of given points is greater than 400, segmented processing
is used. The region is split into rectangular segments, each having less
than
<i>segmax</i> points and interpolation is performed on each segment
of the region. To ensure the smooth connection of segments the interpolation
function for each segment is computed using the points in a given segment
and the points in its neighborhood. The minimum number of points taken
for interpolation is controlled by <i>npmin</i>, the value of which must
be larger than <i>segmax</i> and less than 400. This limit of 400 was selected
to ensure the numerical stability and efficiency of the algorithm. The
program writes important values related to the computation to the history
file of raster map <i>elev</i>.
<h2>
OPTIONS</h2>
The user can run this program either interactively or non-interactively.
The program will be run non-interactively if the user specifies program
arguments and flag settings on the command line using the form:
<dl>
<dd>
<b>s.surf.tps input=</b>name <b>elev=</b>name</dd>

<dd>
[<b>slope=</b>name] [<b>aspect=</b>name]</dd>

<dd>
[<b>pcurv=</b>name] [<b>tcurv=</b>name] [<b>mcurv=</b>name]</dd>

<dd>
[<b>maskmap=</b>name] [<b>dmin1=</b>val] [<b>zmult=</b>val]</dd>

<dd>
[<b>tension=</b>val] [<b>smooth=</b>val]</dd>

<dd>
[<b>segmax=</b>val] [<b>npmin=</b>val]</dd>
</dl>
Alternatively, the user can simply type <b>s.surf.tps</b> on the command
line without program arguments. In this case, the user will be prompted
for parameter values and flag settings using the standard GRASS <a href="parser.html">parser</a>
interface described in the manual entry for <i><a href="parser.html">parser</a></i>.
<h3>
Parameters:</h3>

<dl>
<dt>
<b>input=</b><i>name</i></dt>

<dd>
Use the existing site file <i>name</i> as input.</dd>

<dt>
<b>elev=</b><i>name</i></dt>

<dd>
Output elevation values to raster file named <i>name</i>.</dd>

<dt>
<b>slope=</b><i>name</i></dt>

<dd>
Output slope values to raster file named <i>name</i>.</dd>

<dt>
<b>aspect=</b><i>name</i></dt>

<dd>
Output aspect values to raster file named <i>name</i>.</dd>

<dt>
<b>pcurv=</b><i>name</i></dt>

<dd>
Output profile curvature values to raster file named <i>name</i>.</dd>

<dt>
<b>tcurv=</b><i>name</i></dt>

<dd>
Output tangential curvature values to raster file named <i>name</i>.</dd>

<dt>
<b>mcurv=</b><i>name</i></dt>

<dd>
Output mean curvature values to raster file named <i>name</i>.</dd>

<dt>
<b>maskmap=</b><i>name</i></dt>

<dd>
Use the existing raster file <i>name</i> as a mask.</dd>

<dt>
<b>dmin1=</b><i>val</i></dt>

<dd>
Set min distance between points to <i>val</i>. Default value is set to
0.5 grid cell size.</dd>

<dt>
<b>zmult=</b><i>val</i></dt>

<dd>
Convert z-values using conversion factor <i>val</i>. Default value is 1.</dd>

<dt>
<b>tension=</b><i>val</i></dt>

<dd>
Set tension to <i>val</i> . Default value is 40, appropriate for smooth
surfaces.</dd>

<dt>
<b>smooth=</b><i>val</i></dt>

<dd>
Set smoothing parameter to <i>val</i> . Default value is 0, no smoothing
is performed.</dd>

<dt>
<b>segmax=</b><i>val</i></dt>

<dd>
Set max number of points per segment to <i>val</i>. Default value is 40.</dd>

<dt>
<b>npmin=</b><i>val</i></dt>

<dd>
Set min number of points for interpolation to <i>val</i>. Default value
is 150, for data with heterogeneous spatial distribution higher value is
suggested (see Notes).</dd>

<br>&nbsp;
<p>&nbsp;
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;</dl>

<h2>
NOTES</h2>
<i>LINUX</i> There are some peculiar differences between s.surf.tps for
LINUX and e.g. for SUN.
<dl>
<dd>
- e.g. the interpolation of the heroldsberg elevation maps was using on
SUN a temporary space of 170Mb, on LINUX approx. 80Mb.</dd>
</dl>
Please play with the parameters for a reasonalble result.
<p><i>s.surf.tps</i> uses regularized spline with tension for interpolation
from point data (as described in Mitasova and Mitas, in press). The implementation
has an improved segmentation procedure based on quadtrees which enhances
the efficiency for large data sets. Special color tables are created by
the program for output raster files.
<p>Topographic parameters are computed directly from the interpolation
function so that the important relationships between these parameters are
preserved. The equations for computation of these parameters and their
interpretation is described in Mitasova and Hofierka, in press. Slopes
and aspect are computed in degrees (0-90 and 1-360 respectively). The aspect
raster file has value 0 assigned to flat areas (with slope less than 0.1%)
and to singular points with undefined aspect. Aspect points downslope and
is 90 to the North, 180 to the West, 270 to the South and 360 to the East,
the values increase counterclockwise. Curvatures are positive for convex
and negative for concave areas. Original values of curvatures are multiplied
by 100000, to conform with GRASS integer raster files. Therefore any curvature
lower than 0.00001 will be zero. Flat areas have zero curvatures and singular
points have codes 1000000, 2000000, 3000000 for peak, pit and saddle respectively.
We suggest to use these codes only to distinguish areas (grid cells) with
undefined curvature because the codes are assigned using the theorems from
differential geometry but have never been tested.
<p>The program gives warning when significant overshoots appear and higher
tension should be used. However, with tension too high the resulting surface
changes its behavior to membrane (rubber sheet stretched over the data
points resulting in a peak or pit in each given point and everywhere else
the surface goes rapidly to trend). Smoothing can also be used to reduce
the overshoots if the resulting surface should be smooth.
<p>For data with values changing over several magnitudes (sometimes the
concentration or density data) it is suggested to interpolate the log of
the values rather than the original ones.
<p>The program checks the numerical stability of the algorithm by computation
of values in given points, and prints the maximum difference found into
the history file of raster map <i>elev</i>. Significant increase in tension
is suggested if the difference is unacceptable. For computation with smoothing
set to 0 this difference should be 0. With smoothing parameter greater
than zero the surface will not pass through the data points and the higher
the parameter the closer the surface will be to the trend. The maximum
difference between the given and approximated value in this case reflects
the smoothing effect on data. For theory on smoothing with splines and
their statistical interpretation see Talmi and Gilat 1977, Wahba 1990,
and Hutchinson 1992, where you can find also a comparison of smoothing
splines with kriging.
<p>The program writes the values of parameters used in computation into
the comment part of the history file <i>elev</i> as well as the following
values which help to evaluate the results and choose the suitable parameters:
minimum and maximum z values in the data file (zmin_data, zmax_data) and
in the interpolated raster map (zmin_int, zmax_int), maximum difference
between the given and interpolated z value in a given point (errtotal),
rescaling parameter used for normalization (dnorm), which influences the
tension (see Mitasova, 1992; Mitasova and Mitas, in press).
<p>If a visible connection of segments appears, the program should be rerun
with higher <i>npmin</i> to get more points from the neighborhood of the
given segment.
<p>If the number of points in a site file is less then 400, <i>segmax</i>
should be set to 400 so that segmentation is not performed when it is not
necessary.
<p>The program gives a warning when the user wants to interpolate outside
the rectangle given by the minimum and maximum coordinates in the site
file, zooming into the area where the points are is suggested in this case.
<p>When a mask is used, the program takes all points in the given region
for interpolation, including those in the area which is masked out, to
ensure proper interpolation along the border of the mask. It therefore
does not mask out the data points; if this is desirable, it must be done
outside <i>s.surf.tps</i>.
<p>The program was used for various applications with the following parameters
:
<dd>
<b>"interpolation of DEM from digitized contours"</b></dd>

<pre>tension 20. - 80.
smoothing 0.01 - 1.0
segmax&nbsp; 40
npmin&nbsp;&nbsp; 200 - 300
(low tension was used for relatively flat terrain, high tension
was necessary for terrain with sharp changes in slope, low value of
smoothing is usually sufficient for dense and accurately digitized
contours, for less dense and not very carefully digitized contours,
higher smoothing is suggested)

</pre>
<b>"interpolation of precipitation from climatic stations"</b>
<pre>tension 40. - 150.
smoothing&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0. - 2.
segmax&nbsp; 40
npmin&nbsp;&nbsp; 200

</pre>
<b>"interpolation of concentration of chemicals"</b>
<pre>tension 20.&nbsp; -&nbsp; 60.
smoothing&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.5 - 5.0

</pre>
The user must run <i><a href="g.region.html">g.region</a></i>before the
program to set the region for interpolation.
<h2>
SEE ALSO</h2>
<i>s.surf.rst</i>
<br><i><a href="v.to.sites.html">v.to.sites</a></i>
<br><i><a href="g.region.html">g.region</a></i>
<br><i><a href="r.surf.contour.html">r.surf.contour</a></i>
<br><i><a href="r.surf.idw.html">r.surf.idw</a></i>
<br><i><a href="r.surf.idw2.html">r.surf.idw2</a></i>
<br><i><a href="s.surf.idw.html">s.surf.idw</a></i>
<h2>
AUTHOR</h2>
<i>Original version of program (in FORTRAN)</i>:
<br>Helena Mitasova, Illinois Natural History Survey and US Army CERL,
Champaign, Illinois Comenius University, Bratislava, Czechoslovakia,
<br>Lubos Mitas, Department of Physics, University of Illinois at Urbana
Champaign, Illinois Institute of Physics, Bratislava, Czechoslovakia
<p><i>Modified program (translated to C, adapted for GRASS , segmentation
procedure)</i>:
<br>Irina Kosinovsky, US Army CERL
<br>Dave Gerdes, U.S.Army Construction Engineering Research Laboratory
<h2>
REFERENCES</h2>

<p><br>Mitasova and Mitas 1993: Interpolation by Regularized Spline with
Tension: I. Theory and Implementation,
<br><i>Mathematical Geology</i> ,25, 641-655.
<p>Mitasova and Hofierka 1993: Interpolation by Regularized Spline with
Tension: II. Application to Terrain Modeling
<br>and Surface Geometry Analysis, <i>Mathematical Geology</i> 25, 657-667.
<p>Mitas, L., Mitasova, H., 1999, Spatial Interpolation. In: P.Longley,
M.F. Goodchild, D.J. Maguire, D.W.Rhind (Eds.), Geographical Information
Systems: Principles, Techniques, Management and Applications, Wiley, pp.481-492
<p>Mitasova, H., 1992. New capabilities for interpolation and topographic
analysis in GRASS, <i>GRASSClippings</i>, v.6, No.2 (summer), p 13.
<p>Mitasova, H., 1992. Surfaces and modeling, <i>GRASSclippings</i>, v.6,
No.3 (winter), pp 16-18.
<p>Talmi, A. and Gilat, G., 1977. Method for smooth approximation of data,
<i>Journal
of Computational Physics</i>, 23, pp 93-123.
<p>Wahba, G., 1990. Spline models for observational data, CNMS-NSF Regional
Conference series in applied mathematics, 59, SIAM, Philadelphia, Pennsylvania.
</body>
</html>
