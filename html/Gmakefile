GRASS_MANDIR=./man_new
HTML_DIR=./html

# the files we want to create/update are now MAN_FILES
all: copy $(GRASS_MANDIR) $(MAN_FILES)

#copy the HTML pages
copy:
	if [ ! -d $(GISBASE)/html ]; then mkdir $(GISBASE)/html; fi
	(tar -cf - * | (cd $(GISBASE)/html; tar -xf - 2>/dev/null ); true )


# process the html pages into man pages
%.man: %.html
	$SRCDIR/scripts/contrib/g.html2man/g.html2man $< > $@

# make sure the man directory exists
$(GRASS_MANDIR):
	test -d $(GRASS_MANDIR) || mkdir -p $(GRASS_MANDIR)

# copy the man pages
$(GRASS_MANDIR)/%:% $(GRASS_MANDIR)
	cp $< $@


# set HTML_FILES to the set of .html files in HTML_DIR
HTML_FILES = $(wildcard $(HTML_DIR)/*.html)

# transform HTML_FILES to MAN_FILES
# substitute .man for .html in HTML_FILES
MAN_TMP = $(subst .html,.man,$(HTML_FILES))

# substitute MAN_DIR for HTML_DIR in MAN_TMP
MAN_FILES = $(subst $(HTML_DIR),$(MAN_DIR),$(MAN_TMP))
	%.man

#
