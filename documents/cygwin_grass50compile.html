<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
   <meta name="Author" content="Andreas C. Lange">
   <title>GRASS 5.0 Cygwin Compiling</title>
</head>
<body text="#000000" bgcolor="#FFFFFF" link="#0000EE" vlink="#551A8B" alink="#FF0000">

<hr size=5 noshade width="100%">
<center>
<h1>
Compiling GRASS 5.0 on Win32 with Cygwin 1.x
</h1>
</center>

<center>
<h1>
(arch i686-pc-cygwin)
</h1>
<tt>

$Date$

</tt>


</center>

<hr size=5 noshade width="100%">
<br>I describe here what i did to compile
the recent CVS tree of GRASS 5.0.0 on Windows with the cygwin tools
on a Windows 2000, Windows NT 4.0 or Windows XP machine.
<p>Note that GRASS 5.0 on Win32 is still experimental,
so expect some functionality missing or not working.
<p>You need:
<ul>
<li>
Windows NT 4.0 (SP3 or higher) or Windows 2000 Professional or Windows XP,

<br>(Windows 9x and Windows ME currently unsupported),</li>
<li>
Cygwin, latest release,</li>

<li>
NTFS filesystem (FAT will not work!),</li>

<li>
libraries and additions see below.</li>
</ul>
This text was written by Andreas Lange.
Most of the text was taken out of the description from John Huddleston<!--&lt;<i>John.Huddleston@usda.gov</i>>-->. Thanks to Malcolm
Blue<!-- &lt;<i>mblue@nb.sympatico.ca</i>>--> 
for corrections and the cygwin lists. All errors and mistakes are of course
mine.
<br>
<hr size=5 noshade width="100%">

<h2>1. Get the Cygwin tools</h2>
Get the latest version from <a href="http://sources.redhat.com/cygwin/download.html">http://sources.redhat.com/cygwin/download.html</a>.
<p>Download the file <tt>setup.exe</tt>
to a local disk, run it and follow the instructions. The <tt>setup.exe</tt>
program will prompt you for one of three choices, if you never have loaded
the Cygwin software, select download from internet. If you have a previous
version you should know what to do. If you have never done this, it will
prompt you for a directory to install the files.
<p>If you are new to cygwin, you should look
at some of the documentation available at this site.
<p>When installing the Cygwin tools, please
select all available packages, or at least:
<ul>
<li>
ash, autoconf*, automake*, bash, binutils,
bison,
<br>byacc, bzip2, clear, cvs*, cygwin, dejagnu*, diff,
expect*, 
<br>file, fileutils, findutils, flex, gawk,
gcc, gdb*, 
<br>gettext, grep, groff, gzip, inetutils,
jpeg, 
<br>less, libpng, login, m4*, make, man,
ncurses, 
<br>opengl, patch, perl, readline, regex,
sed, 
<br>sh-utils/shellutils, tar, tcltk, tcsh,
termcap, texinfo, 
<br>textutils, tiff, time, unzip, vim*, w32api,
zip, zlib.
<li>
The packages marked with an asterisk (*) in
this list are not strictly required for compiling GRASS, but may be
useful for development work. </li>
</ul>
If you install all available packages it will
save you from much hassle later when you need these libraries for GRASS.
<p>Please select for the install directory
a local drive on your computer with enough space for the entire cygwin
distribution (150 MB without X11R6.4), the X11R6.4 installation (additional
65 MB), the grass source code (100 MB), the object files and libraries
(around 100 MB) and the grass binaries (programs, 100 MB to 150 MB)). If
you want to do real work, you need at least another 500 MB for GRASS data
storage.
<p>You need Perl for the manpage-generation
with g.html2man. Perl 5.6 now is part of the contrib section, so install
it with the main installation.
<p>
Now start CYGWIN (double-click the cygwin.bat). A new window will open.

<h2>2. Get the latest source code for GRASS</h2>
Get the source code from: <a href="http://grass.itc.it/grass5/source/">http://grass.itc.it/grass5/source/</a>.
<br>Checkout either from the <a href="http://grass.itc.it/grasscvs.html">CVS
repository</a> (if you have CVS installed already), download the <a
href="ftp://grass.itc.it/pub/grass/grass5/source/snapshot/">weekly snapshot </a>or the <a href="ftp://grass.itc.it/pub/grass/grass5/source/">release source packet</a>.
Or you connect to the <a href="http://grass.itc.it/grasscvs.html">GRASS CVS server</a> using the <a href="http://www.cvshome.org/dev/codewindow.html">cygwin cvs tool</a>
(unpack and move within cygwin to /usr/bin/).

<p>Store the GRASS source code within the
Cygwin environment (you can do that even from outside the Cygwin within the
Explorer software).
<p>
Unpack the source code in any directory of your choice, e. g. in your home directory:
<pre><tt>cd $HOME</tt></pre>

<pre><tt>mkdir grass.src</tt></pre>

<pre><tt>cd grass.src</tt></pre>
<tt>tar xzf /path/to/file/grass5.0*_src.tar.gz</tt>

<h2>3. Install sunrpc/xdrlib</h2>
You need the sun rpc (remote procedure call)
library that contains the xdr (external data representation) library.
<br>Download the binary file from (store into
cygwin directory) file:
<br><a
href="http://grass.itc.it/grass5/binary/windows_cygnus/sunrpc/"><tt>http://grass.itc.it/grass5/binary/windows_cygnus/sunrpc/sunrpc-4.0.cygwin1.bin.tar.gz</a></tt>
<p>Go to the root directory (<tt>cd
/</tt>) and unpack
this file:
<pre><tt>tar xzf /where/ever/you/saved/this/sunrpc-4.0.cygwin1.bin.tar.gz</tt></pre>

<h2>4a. Install the X11 libraries and the X Server</h2>
For compiling the GRASS XDRIVER (monitors
for graphical output), you need the X11 libraries. Get them from <a href="http://sources.redhat.com/cygwin/xfree/">http://sources.redhat.com/cygwin/xfree/</a>.
Download at least the following packages (you find them on <a href="ftp://mirrors.rcn.net/pub/sourceware/cygwin/xfree/xc-4-binaries/4.0.3/">ftp://mirrors.rcn.net/pub/sourceware/cygwin/xfree/xc-4-binaries/4.0.3/</a>):
devel, DLLs, fonts, Prog, twm, Xterm, Xwin and updates.

<p>Please refer to the <a href="http://sources.redhat.com/cygwin/xfree/docs/howto/book1.htm">XFree
install guide</a> for further details.
<p>Please check out yourself the actual version
and source as this changes frequently.

<h2>4b. Get the tcl/tk 8.x libraries</h2>
Download the actual precompiled tcl/tk 8.x
libraries and executables from
<br><a href="http://grass.itc.it/grass5/binary/windows_cygnus/">http://grass.itc.it/grass5/binary/windows_cygnus/</a>.

<p>
Go to the root directory (<tt>cd /</tt>) and unpack this file:

<pre><tt>&nbsp; tar xzf /where/ever/you/saved/this/xtcltk-*.tar.gz</tt></pre>


<h2>5. Some additional changes to do</h2>
Create a softlink from less to more:
<pre><tt>ln -s /bin/less /bin/more</tt></pre>
Otherwise the grass shell will not run correctly.
<p>
Move the ash and shell binary out of the way and create a softlink from
bash to sh:  

<pre><tt>cd /bin</tt></pre>
<pre><tt>mv ash.exe ash.old</tt></pre>
<pre><tt>mv sh.exe ash.exe</tt></pre>
<pre><tt>ln -s bash.exe sh.exe</tt></pre>

This fixes a problem with g.manual. 

<p>Sometimes <tt>'libz.dll'</tt>
is not found. Copy it over from <tt>/usr/X11R6/lib/libz.dll</tt>
to <tt>/lib/libz.dll</tt>.
<p>Do <tt>'export MAKE_MODE=unix'</tt>
from the command shell (sh, bash). This is usually the default, but it
does not hurt to export it.
<p>Add <tt>/usr/local/bin</tt>
and <tt>/bin</tt> to your path if they
are not included (<tt>echo $PATH</tt>
to check, <tt>export PATH=/usr/local/bin:/usr/bin:$PATH</tt>
to add). Please start the compile (see paragraph 7) from within the cygwin shell,
not from a DOS/cmd shell under Windows.
<p>For sure i have forgotten something. If
a module doesn't compile, get back here and check.

<h2>6. Check the REQUIREMENTS file</h2>
Check the file <tt>REQUIREMENTS</tt>
in the GRASS distribution root directory for any missing libraries and
get and compile them if needed.

<h2>7. And now FINALLY to the GRASS compilation</h2>
Open a cygwin command window (cygwin shell,
started with the desktop icon created by setup). From there change to the
directory with the source code and start the configuration and compilation
steps with the following commands:
<pre><tt>&nbsp; cd /to/source/code/of/grass</tt></pre>

<pre><tt>&nbsp; ./configure --with-postgres=no \</tt>
<tt>&nbsp;&nbsp;&nbsp; --x-includes=/usr/X11R6/include \</tt>
<tt>&nbsp;&nbsp;&nbsp; --x-libraries=/usr/X11R6/lib \</tt>
<tt>&nbsp;&nbsp;&nbsp; --with-tcltk-libs=/usr/local/lib \</tt>
<tt>&nbsp;&nbsp;&nbsp; --with-tcltk-includes=/usr/local/include</tt></pre>

<pre><tt>&nbsp; make</tt></pre>

<pre><tt>&nbsp; make install</tt></pre>
All libraries and modules that do not build
correctly are listed in the file <tt>error.log</tt>.
Read this file and fix the errors in the source code. Re-run make from
the top source directory or proceed from the according directory of the
source code with:
<pre><tt>&nbsp; gmake5</tt></pre>
if you already installed GRASS.
<p>Please report any problems, errors and
solutions to the GRASS developers mailing list at <a href="mailto:grass5@grass.itc.it">grass5@grass.itc.it</a>.

<h2>8. Header file creation</h2>
If you ran into compiling errors after configure'ing
and make'ing (see paragraph 7), check the header file <tt>src/CMD/head/head.i686-pc-cygwin</tt>.
This file was created from the template in the file <tt>src/CMD/head/head</tt>
with the make command. You can find a sample header file under
<tt>src/CMD/head/os-specific/<a
href="http://freegis.org/cgi-bin/viewcvs.cgi/~checkout~/grass/src/CMD/head/os_specific/head.i686-pc-cygwin">head.i686-pc-cygwin</a></tt>.
<p>Under some circumstances the X11 header
files and libraries are not found. The X11 headers are in <tt>/usr/X11R6/include</tt>,
but some stray files are in <tt>/usr/include/X11</tt>.
You should rename or delete this directory, so that it is not found by
configure. Please remember that you have to rename or delete this directory
each time you update your cygwin installation. The lines in the GRASS header
file should read:
<pre><tt>XLIBPATH = -L/usr/X11R6/lib</tt></pre>

<pre><tt>XINCPATH = -I/usr/X11R6/include</tt></pre>

<pre><tt>and/or</tt></pre>
<tt>XCFLAGS = -I/usr/X11R6/include</tt>

<h2>9. Running GRASS</h2>
Please read the <a href="cygwin_grass50bininstall.html#Start GRASS">paragraph
"Starting GRASS 5" in the binary installation document</a>.

<h2>10. This build was compiled with Cygwin 1.1.8</h2>
Read about Unix running under Windows here:
<ul>
<li><a href="http://sources.redhat.com/cygwin/docs.html">http://sources.redhat.com/cygwin/docs.html</a></li>
</ul>

<hr size=5 noshade width="100%">

<h2>Changes to the last build/cygwin version</h2>
Perl is now part of the contrib section of
cygwin. No need to create a link from <tt>/usr/local/bin/perl.exe</tt>
to <tt>/usr/bin/perl</tt> with <br>
<tt>ln -s /usr/local/bin/perl.exe /usr/bin/perl.</tt>
<p>No need to create a shell script /bin/yacc
with the contents:
<br><tt>#!/bin/sh</tt>
<br><tt>bison --yacc $@</tt>
<br>and do a <tt>chmod a+x /usr/bin/yacc</tt>.
<br>Configure now checks for bison too.
<p>The ipc setup and the ipc-daemon are no
longer needed, as sockets are now the default transport mechanism.
<p>The netbpm header files are now part of
the GRASS source, but netpbm-9.8 is very userful, so i recommend to install
it.
<p>The following libraries are now included
in the contrib section for cygwin:
<ul>
<li>libncurses: Version 5.2-1</li>
<li>libgdbm: Version 1.8.0-3</li>
<li>libpng: Version 1.0.8-2</li>
<li>libtiff: Version 3.5.5-3</li>
<li>libjpeg: Version 6b-3</li>
<li>libz: Version 1.1.3-5</li>
</ul>
g77 is part of gcc now, so no need to install
anything manually.
<p>ncurses 5.0 is part of the cygwin distribution
now (under contrib).
<p>The check that the #define CURSORS_MAXY
is not NONE and the definition of #define HAVE_CURSORS in the file src/include/config.h
is already done with configure.
<p>General problems with my build:
<br>see sections PROBLEM in the above text,
<br>g.html2man needs Perl, but Perl is not
included in the standard Cygwin distribution (and i have only installed
a Windows port of Perl).
<br>src/fonts/for_grass: PROBLEM with the
program that converts the fonts to the GRASS internal binary format (only
with Win 9x, not with NT 4.0/2000).
<p>
<hr size=5 noshade width="100%">
<font size=-2>
Andreas Lange, andreas.lange@rhein-main.de, 
$Date$
</font>
</body>
</html>
